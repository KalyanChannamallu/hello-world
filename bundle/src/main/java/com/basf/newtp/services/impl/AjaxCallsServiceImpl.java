package com.basf.newtp.services.impl;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

//import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang.StringUtils;
import org.apache.felix.scr.annotations.Component;
import org.apache.felix.scr.annotations.Properties;
import org.apache.felix.scr.annotations.Property;
import org.apache.felix.scr.annotations.Reference;
import org.apache.felix.scr.annotations.Service;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.basf.newtp.jackson.beans.CustomersListBean;
import com.basf.newtp.jackson.beans.ErrorBean;
import com.basf.newtp.jackson.beans.ProductsListBean;
import com.basf.newtp.jackson.beans.TreeOutput;
import com.basf.newtp.services.api.AjaxCallsService;
import com.basf.newtp.services.api.GetServiceConnection;
import com.basf.newtp.utils.CastIronServiceProperties;
import com.basf.newtp.utils.ErrorConstants;
import com.basf.newtp.utils.HybrisServiceProperties;
import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;

/**
 * author : Madhava Yaddala created on : 29/03/14 for: All ajax call
 * implementation methods
 */

@Component
@Service
@Properties({
		@Property(name = "service.pid", value = "com.aosmith.portal.orderquote.util.AjaxCallsServiceImpl"),
		@Property(name = "service.description", value = "AOS AjaxCallsServiceImpl"),
		@Property(name = "service.vendor", value = "AO Smith") })
public class AjaxCallsServiceImpl implements AjaxCallsService {

	@Reference
	GetServiceConnection getServiceConnection;
	static final Logger log = LoggerFactory.getLogger("AjaxCallsServiceImpl");
	ObjectMapper objectMapper = null;

	/**
	 * author : Deepthi Vikram created on : 29/03/14 for : Fetching Customers'
	 * Records from SAP based on user entered criteria
	 */
	public CustomersListBean getCustomerResults(String inputJson) {
		log.info("entering get Customer results method");

		// initializing required objects
		getServiceConnection = new GetServiceConnectionImpl();
		objectMapper = new ObjectMapper();
		CustomersListBean customersListBean = new CustomersListBean();
		String errorResponseString = null;
		ErrorBean errorBean = new ErrorBean();
		List<ErrorBean> errorBeanList = new ArrayList<ErrorBean>();

		// Forming Cast Iron Url for Customers' data fetch
		String serverUrl = CastIronServiceProperties.castironServer;
		String endPoint = CastIronServiceProperties.castironCustomerLookupEndPoint;
		String urlString = serverUrl + "/" + endPoint;

		try {
			// initiating connection to Cast Iron service
			getServiceConnection.invokePost(urlString, inputJson);
			String responseString = getServiceConnection.getResponseString();
			int statusCode = getServiceConnection.getStatusCode();
			log.debug("Status Code : " + statusCode);
			errorResponseString = getServiceConnection.getConnectionError();

			// if Cast Iron connection established
			if (StringUtils.isEmpty(errorResponseString)) {
				customersListBean = objectMapper.readValue(responseString,
						CustomersListBean.class);
				if (null != customersListBean.getError()
						&& customersListBean.getError().size() > 0) {
					for (ErrorBean error : customersListBean.getError()) {
						if (!StringUtils.isEmpty(error.getFaultmessage())
								|| !StringUtils.isEmpty(error.getFaultname())) {
							error.setErrormessage(ErrorConstants.ERROR_CUSTOMER_MESSAGE);
						}
					}
				}
			} else {
				// if Cast Iron connection failed
				errorBean.setErrormessage(errorResponseString);
				errorBeanList.add(errorBean);
				customersListBean.setError(errorBeanList);
			}
		} catch (JsonParseException jpExp) {
			log.error("Error while parsing Json :" + jpExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_CUSTOMER_MESSAGE);
			errorBeanList.add(errorBean);
			customersListBean.setError(errorBeanList);
		} catch (JsonMappingException jmExp) {
			log.error("Error while mapping Json :" + jmExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_CUSTOMER_MESSAGE);
			errorBeanList.add(errorBean);
			customersListBean.setError(errorBeanList);
		} catch (IOException ioExp) {
			log.error("IOException while parsing Json :" + ioExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_CUSTOMER_MESSAGE);
			errorBeanList.add(errorBean);
			customersListBean.setError(errorBeanList);
		} catch (Exception exception) {
			log.error("Generic Exception while parsing Json:" + exception);
			// /Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_CUSTOMER_MESSAGE);
			errorBeanList.add(errorBean);
			customersListBean.setError(errorBeanList);
		}

		return customersListBean;

	}

	/* Method for fetching products from hybris based on the search criteria */
	public ProductsListBean getPartsResults(String inputParameter) {

		String serverUrl = HybrisServiceProperties.hybrisServer;
		String endPoint = HybrisServiceProperties.hybrisPartsLookupEndPoint;
		String urlString = serverUrl + "/" + endPoint + "query="
				+ inputParameter;
		log.debug("Url for fetching part results:" + urlString);
		objectMapper = new ObjectMapper();
		ProductsListBean productsListBean = new ProductsListBean();
		String errorResponseString = null;
		ErrorBean errorBean = new ErrorBean();
		List<ErrorBean> errorBeanList = new ArrayList<ErrorBean>();
		try {
			getServiceConnection.invokeGet(urlString, inputParameter);
			errorResponseString = getServiceConnection.getConnectionError();
			if (StringUtils.isEmpty(errorResponseString)) {
				int statusCode = getServiceConnection.getStatusCode();
				log.debug("Status code:" + statusCode);
				String responseString = getServiceConnection
						.getResponseString();
				// String responseString =
				// "{\n    \"products\": [\n        {\n            \"materialNumber\": \"mat154\",\n            \"classifications\": [\n                {\n                    \"name\": \"electric\",\n                    \"features\": [\n                        {\n                            \"range\": false,\n                            \"name\": \"Fuel Type\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"electric\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.fueltype\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5/5.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"1ph\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phase\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Anode\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.anode\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Pressure Rtg\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"150PSI\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.pressurerating\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Total KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.totalkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element Mat'l\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementmatl\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase HZ\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"60HZ\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phasehz\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"T&P Location\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ST&P\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.tplocation\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Language\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"EN\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.language\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Elements\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elements\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Voltage\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"120V\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.voltage\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Control\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"4-WIRE\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.controlcodes\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Construction\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ASME\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.construction\"\n                        }\n                    ],\n                    \"code\": \"electric\"\n                }\n            ],\n            \"stock\": {\n                \"stockLevelStatus\": {\n                    \"code\": \"inStock\",\n                    \"codeLowerCase\": \"instock\"\n                },\n                \"stockLevel\": 0\n            },\n            \"code\": \"839\",\n            \"modelNumber\": \"model154\"\n        },\n        {\n            \"materialNumber\": \"mat155\",\n            \"classifications\": [\n                {\n                    \"name\": \"electric\",\n                    \"features\": [\n                        {\n                            \"range\": false,\n                            \"name\": \"Fuel Type\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"electric\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.fueltype\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5/5.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"1ph\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phase\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Anode\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.anode\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Pressure Rtg\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"150PSI\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.pressurerating\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Total KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.totalkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element Mat'l\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementmatl\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase HZ\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"60HZ\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phasehz\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"T&P Location\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ST&P\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.tplocation\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Language\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"EN\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.language\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Elements\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elements\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Voltage\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"120V\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.voltage\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Control\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"4-WIRE\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.controlcodes\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Construction\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ASME\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.construction\"\n                        }\n                    ],\n                    \"code\": \"electric\"\n                }\n            ],\n            \"stock\": {\n                \"stockLevelStatus\": {\n                    \"code\": \"inStock\",\n                    \"codeLowerCase\": \"instock\"\n                },\n                \"stockLevel\": 0\n            },\n            \"code\": \"839\",\n            \"modelNumber\": \"model154\"\n        }\n    ],\n    \"pagination\": {\n        \"pageSize\": 20,\n        \"currentPage\": 0,\n        \"totalResults\": 1,\n        \"totalPages\": 1\n    },\n    \"sorts\": [],\n    \"currentQuery\": {\n        \"query\": {\n            \"value\": \"839:\"\n        },\n        \"url\": \"/search?q=839%3A\"\n    },\n    \"facets\": [],\n    \"breadcrumbs\": [],\n    \"freeTextSearch\": \"839\",\n    \"spellingSuggestion\": {\n        \"query\": \"239:\",\n        \"suggestion\": \"239\"\n    }\n}";

				productsListBean = objectMapper.readValue(responseString,
						ProductsListBean.class);

			} else {
				// Setting generic error message in case of service connection
				// failure
				errorBean.setErrormessage(errorResponseString);
				errorBeanList.add(errorBean);
				productsListBean.setError(errorBeanList);
			}

		} catch (JsonParseException jpExp) {
			log.error("Error while parsing Json :" + jpExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (JsonMappingException jmExp) {
			log.error("Error while mapping Json :" + jmExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (IOException ioExp) {
			log.error("IOException while parsing Json :" + ioExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (Exception exception) {
			log.info("Exception : " + exception);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		}
		return productsListBean;

	}

	/* Method for fetching products from hybris based on the filter criteria */
	public ProductsListBean getPartsFilterResults(String inputParameter) {

		String serverUrl = HybrisServiceProperties.hybrisServer;
		String endPoint = HybrisServiceProperties.hybrisPartsLookupEndPoint;
		String urlString = serverUrl + "/" + endPoint + "categoryId:"
				+ inputParameter;
		log.debug("Url for fetching part results:" + urlString);
		objectMapper = new ObjectMapper();
		ProductsListBean productsListBean = new ProductsListBean();
		String errorResponseString = null;
		ErrorBean errorBean = new ErrorBean();
		List<ErrorBean> errorBeanList = new ArrayList<ErrorBean>();
		try {

			getServiceConnection.invokeGet(urlString, inputParameter);
			errorResponseString = getServiceConnection.getConnectionError();
			int statusCode = getServiceConnection.getStatusCode();
			log.debug("Status code:" + statusCode);
			if (StringUtils.isEmpty(errorResponseString)) {
				String responseString = getServiceConnection
						.getResponseString();
				// String responseString =
				// "{\n    \"products\": [\n        {\n            \"materialNumber\": \"mat154\",\n            \"classifications\": [\n                {\n                    \"name\": \"electric\",\n                    \"features\": [\n                        {\n                            \"range\": false,\n                            \"name\": \"Fuel Type\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"electric\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.fueltype\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5/5.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"1ph\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phase\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Anode\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.anode\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Pressure Rtg\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"150PSI\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.pressurerating\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Total KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.totalkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element Mat'l\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementmatl\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase HZ\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"60HZ\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phasehz\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"T&P Location\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ST&P\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.tplocation\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Language\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"EN\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.language\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Elements\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elements\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Voltage\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"120V\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.voltage\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Control\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"4-WIRE\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.controlcodes\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Construction\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ASME\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.construction\"\n                        }\n                    ],\n                    \"code\": \"electric\"\n                }\n            ],\n            \"stock\": {\n                \"stockLevelStatus\": {\n                    \"code\": \"inStock\",\n                    \"codeLowerCase\": \"instock\"\n                },\n                \"stockLevel\": 0\n            },\n            \"code\": \"839\",\n            \"modelNumber\": \"model154\"\n        },\n        {\n            \"materialNumber\": \"mat155\",\n            \"classifications\": [\n                {\n                    \"name\": \"electric\",\n                    \"features\": [\n                        {\n                            \"range\": false,\n                            \"name\": \"Fuel Type\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"electric\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.fueltype\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5/5.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"1ph\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phase\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Anode\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.anode\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Pressure Rtg\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"150PSI\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.pressurerating\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Total KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.totalkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element Mat'l\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementmatl\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase HZ\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"60HZ\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phasehz\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"T&P Location\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ST&P\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.tplocation\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Language\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"EN\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.language\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Elements\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elements\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Voltage\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"120V\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.voltage\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Control\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"4-WIRE\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.controlcodes\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Construction\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ASME\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.construction\"\n                        }\n                    ],\n                    \"code\": \"electric\"\n                }\n            ],\n            \"stock\": {\n                \"stockLevelStatus\": {\n                    \"code\": \"inStock\",\n                    \"codeLowerCase\": \"instock\"\n                },\n                \"stockLevel\": 0\n            },\n            \"code\": \"839\",\n            \"modelNumber\": \"model154\"\n        }\n    ],\n    \"pagination\": {\n        \"pageSize\": 20,\n        \"currentPage\": 0,\n        \"totalResults\": 1,\n        \"totalPages\": 1\n    },\n    \"sorts\": [],\n    \"currentQuery\": {\n        \"query\": {\n            \"value\": \"839:\"\n        },\n        \"url\": \"/search?q=839%3A\"\n    },\n    \"facets\": [],\n    \"breadcrumbs\": [],\n    \"freeTextSearch\": \"839\",\n    \"spellingSuggestion\": {\n        \"query\": \"239:\",\n        \"suggestion\": \"239\"\n    }\n}";

				productsListBean = objectMapper.readValue(responseString,
						ProductsListBean.class);

			} else {
				// Setting generic error message in case of service connection
				// failure
				errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
				errorBeanList.add(errorBean);
				productsListBean.setError(errorBeanList);
			}

		} catch (JsonParseException jpExp) {
			log.error("Error while parsing Json :" + jpExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (JsonMappingException jmExp) {
			log.error("Error while mapping Json :" + jmExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (IOException ioExp) {
			log.error("IOException while parsing Json :" + ioExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (Exception exception) {
			log.info("Exception : " + exception);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCT_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		}
		return productsListBean;

	}

	/* Method for fetching Filter Tree from Hybris */
	public TreeOutput getFilterTree(String inputParameter) {

		String serverUrl = HybrisServiceProperties.hybrisServer;
		String endPoint = HybrisServiceProperties.hybrisGetCategoriesEndPoint;
		String urlString = serverUrl + "/" + endPoint;
		objectMapper = new ObjectMapper();
		TreeOutput treeOutput = new TreeOutput();
		String errorResponseString = null;
		ErrorBean errorBean = new ErrorBean();
		List<ErrorBean> errorBeanList = new ArrayList<ErrorBean>();
		try {
			getServiceConnection.invokeGet(urlString, inputParameter);
			int statusCode = getServiceConnection.getStatusCode();
			log.debug("status Code:" + statusCode);
			errorResponseString = getServiceConnection.getConnectionError();
			if (StringUtils.isEmpty(errorResponseString)) {
				String responseString = getServiceConnection
						.getResponseString();
				// String responseString =
				// "{\n    \"id\": \"001\",\n    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n    \"name\": \"Water Heating\",\n    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001\",\n    \"subcategories\": [\n        {\n            \"id\": \"001001\",\n            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n            \"name\": \"Residential\",\n            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001\",\n            \"subcategories\": [\n                {\n                    \"id\": \"001001001\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Gas\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001001\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001001001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001001001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001001002\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001001002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001001003\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001001003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001002\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Electric\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001002\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001002001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001002001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001002002\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001002002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001002003\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001002003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001003\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Oil\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001003\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001003001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001003001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001003002\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001003002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001003003\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001003003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001004\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Indirect\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001004\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001004001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001004001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001004002\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001004002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001004003\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001004003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001005\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Solar\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001005\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001005001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001005001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001005002\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001005002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001005003\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001005003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001006\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Heat Pump\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001006\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001006001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001006001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001006002\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001006002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001006003\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001006003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001007\",\n                    \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                    \"name\": \"Geothermal\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001007\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001007001\",\n                            \"lastModified\": \"2014-03-19T02:19:30-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001007001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001007002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001007002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001007003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001007003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001001008\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"None\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001008\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001001008001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001008001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001008002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001008002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001001008003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001001008003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                }\n            ],\n            \"products\": []\n        },\n        {\n            \"id\": \"001002\",\n            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n            \"name\": \"Commercial\",\n            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002\",\n            \"subcategories\": [\n                {\n                    \"id\": \"001002001\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Gas\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002001\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002001001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002001001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002001002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002001002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002001003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002001003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002002\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Electric\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002002\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002002001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002002001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002002002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002002002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002002003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002002003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002003\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Oil\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002003\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002003001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002003001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002003002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002003002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002003003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002003003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002004\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Indirect\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002004\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002004001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002004001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002004002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002004002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002004003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002004003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002005\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Solar\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002005\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002005001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002005001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002005002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002005002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002005003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002005003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002006\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Heat Pump\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002006\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002006001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002006001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002006002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002006002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002006003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002006003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002007\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"Geothermal\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002007\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002007001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002007001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002007002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002007002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002007003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002007003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                },\n                {\n                    \"id\": \"001002008\",\n                    \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                    \"name\": \"None\",\n                    \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002008\",\n                    \"subcategories\": [\n                        {\n                            \"id\": \"001002008001\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tank Type\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002008001\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002008002\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Tankless\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002008002\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        },\n                        {\n                            \"id\": \"001002008003\",\n                            \"lastModified\": \"2014-03-19T02:19:31-05:00\",\n                            \"name\": \"Boiler\",\n                            \"url\": \"/HotWaterSiteUID/catalogs/HotWaterProductCatalog/Online/categories/001002008003\",\n                            \"subcategories\": [],\n                            \"products\": []\n                        }\n                    ],\n                    \"products\": []\n                }\n            ],\n            \"products\": []\n        }\n    ],\n    \"products\": []\n}";
				treeOutput = objectMapper.readValue(responseString,
						TreeOutput.class);
			} else {
				// Setting generic error message in case of service connection
				// failure
				errorBean.setErrormessage(errorResponseString);
				errorBeanList.add(errorBean);
				treeOutput.setError(errorBeanList);
			}
		} catch (JsonParseException jpExp) {
			log.error("Error while parsing Json :" + jpExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_FILTER_MESSAGE);
			errorBeanList.add(errorBean);
			treeOutput.setError(errorBeanList);
		} catch (JsonMappingException jmExp) {
			log.error("Error while mapping Json :" + jmExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_FILTER_MESSAGE);
			errorBeanList.add(errorBean);
			treeOutput.setError(errorBeanList);
		} catch (IOException ioExp) {
			log.error("IOException while parsing Json :" + ioExp);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_FILTER_MESSAGE);
			errorBeanList.add(errorBean);
			treeOutput.setError(errorBeanList);
		} catch (Exception exception) {
			log.error("Exception : " + exception);
			// Setting custom error message
			errorBean.setErrormessage(ErrorConstants.ERROR_FILTER_MESSAGE);
			errorBeanList.add(errorBean);
			treeOutput.setError(errorBeanList);
		}
		return treeOutput;
	}

	/**
	 * author : Anjali Shyamsundar created on : 29/03/14 for : Fetching Product
	 * Attributes from Hybris based on 'MaterialId'
	 */
	public ProductsListBean getProductAttributes(String inputParameter) {

		String serverUrl = HybrisServiceProperties.hybrisServer;
		String endPoint = HybrisServiceProperties.hybrisGetProductAttributesEndPoint;
		String urlString = serverUrl + "/" + endPoint + "query="
				+ inputParameter;
		ObjectMapper objectMapper = new ObjectMapper();
		ProductsListBean productsListBean = new ProductsListBean();
		String errorResponseString = null;
		ErrorBean errorBean = new ErrorBean();
		List<ErrorBean> errorBeanList = new ArrayList<ErrorBean>();

		try {
			getServiceConnection.invokeGet(urlString, inputParameter);
			int statusCode = getServiceConnection.getStatusCode();
			String responseString = getServiceConnection.getResponseString();
			log.debug("StatusCode: " + statusCode);
			errorResponseString = getServiceConnection.getConnectionError();
			if (StringUtils.isEmpty(errorResponseString)) {
				// String responseString =
				// "{\n    \"products\": [\n        {\n            \"materialNumber\": \"mat1\",\n            \"classifications\": [\n                {\n                    \"name\": \"electric\",\n                    \"features\": [\n                        {\n                            \"range\": false,\n                            \"name\": \"Total KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.totalkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element KW\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"2.5/4.5\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementkw\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Elements\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"1\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elements\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"1ph\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phase\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Phase HZ\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"50HZ\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.phasehz\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Voltage\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"120V\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.voltage\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Element Mat'l\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"CU\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/electric.elementmatl\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Anode Material\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"AL-2A\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.anodematerial\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Language\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"EN\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.language\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"T&P Location\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"ST&P\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.tplocation\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Construction\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"STD\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.construction\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Pressure Rating\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"150PSI\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.pressurerating\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Fuel Type\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"electric\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.fueltype\"\n                        },\n                        {\n                            \"range\": false,\n                            \"name\": \"Control\",\n                            \"featureValues\": [\n                                {\n                                    \"value\": \"3-WIRE\"\n                                }\n                            ],\n                            \"comparable\": true,\n                            \"code\": \"HotWaterClassificationCatalog/1.0/general.controlcodes\"\n                        }\n                    ],\n                    \"code\": \"electric\"\n                }\n            ],\n            \"code\": \"741\",\n            \"modelNumber\": \"model1\"\n        }\n    ]\n}";
				productsListBean = objectMapper.readValue(responseString,
						ProductsListBean.class);

			} else {
				errorBean.setErrormessage(errorResponseString);
				errorBeanList.add(errorBean);
				productsListBean.setError(errorBeanList);
			}

		} catch (JsonParseException jpExp) {
			log.error("Error while parsing Json :" + jpExp);
			// Setting custom error message for JsonParseException
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCTATTR_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (JsonMappingException jmExp) {
			log.error("Error while mapping Json :" + jmExp);
			// Setting custom error message for JsonMappingException
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCTATTR_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (IOException ioExp) {
			log.error("IOException while parsing Json :" + ioExp);
			// Setting custom error message for IOException
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCTATTR_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		} catch (Exception exception) {
			log.info("Exception : " + exception);
			// Setting custom error message for general Exception
			errorBean.setErrormessage(ErrorConstants.ERROR_PRODUCTATTR_MESSAGE);
			errorBeanList.add(errorBean);
			productsListBean.setError(errorBeanList);
		}

		return productsListBean;

	}

}
